<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="toy.lms.jwt.mapper.UserLoginMapper">

  <select id="selectUserById" parameterType="String" resultType="toy.lms.jwt.dto.CustomUserDetails">
    SELECT * FROM lms.account WHERE account_id=#{accountId}
  </select>
  <!-- prod -->
  <insert id="insertUserInfo" parameterType="toy.lms.jwt.dto.UserInfoDTO">
    INSERT INTO lms.account(
        account_id,
        password,
        role_id,
        keyword
    ) VALUES (
        #{accountId},
        #{password},
        #{roleId}::uuid,
        #{keyword}
    );
    INSERT INTO lms.profile(
        account_id,
        name_k,
        name_e,
        sex,
        email,
        education,
        tel_num,
        birth,
        image
    ) VALUES (
        #{accountId},
        #{nameK},
        #{nameE},
        #{sex},
        #{email},
        #{education},
        #{telNum},
        #{birth},
        #{image}
    );
  </insert>

  <select id="selectCntDuplicateId" parameterType="String" resultType="int">
    SELECT count(*) FROM lms.account WHERE account_id=#{accountId}
  </select>

  <update id="updateUserInfo" parameterType="toy.lms.member.dto.MemberDTO">
    UPDATE
    lms.account
    SET
      <if test="state != null  and !state.equals('')">
        state = 'OS'
      </if>
    WHERE
        account_id = 'admin1';
  </update>

</mapper>